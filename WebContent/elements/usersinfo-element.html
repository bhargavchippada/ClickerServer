<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<polymer-element name="usersinfo-element">
  <template>
  	<style>
    :host{
      display: block;
      margin:16px 0 0 0;
    }
    #rowheadings {
      font-weight: 800;
    }
    table {
      width: 100%;
      border-collapse: collapse; 
    }
    tr.border_top {
      width: 100%;
      border-top: 1px solid black;
    }
    td,th {
      text-align: center;
      width: 20%;
      padding: 8px 0 8px 0;
    }
    .label {
      color: #fff;
      padding: 4px;
      border-radius: 4px;
    }
    .bgcolor-success {
      background-color: #5CB85C;
    }
    .bgcolor-danger {
      background-color: #D9534F;
    }
    .bgcolor-info {
      background-color: #5bc0de;
    }
    .bgcolor-warning {
      background-color: #f0ad4e;
    }
    .bgcolor-primary {
      background-color: #337ab7;
    }
    .color-success {
      color: #5CB85C;
    }
    .color-danger {
      color: #D9534F;
    }
    .color-info {
      color: #5bc0de;
    }
    .color-warning {
      color: #f0ad4e;
    }
    .color-primary {
      color: #337ab7;
    }
    input {
      width: 80%;
    }
    .thinput {
      padding: 0 0 8px 0;
    }
	  </style>
    <table>
      <thead>
        <tr class="border_top">
          <th id="0" on-click="{{changeSort}}" style="{{sortColumn == '0' ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">Roll-number</th>
          <th id="1" on-click="{{changeSort}}" style="{{sortColumn == '1' ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">Name</th>
          <th id="2" on-click="{{changeSort}}" style="{{sortColumn == '2' ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">Answer</th>
          <th id="3" on-click="{{changeSort}}" style="{{sortColumn == '3' ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">Status</th>
          <th id="4" on-click="{{changeSort}}" style="{{sortColumn == '4' ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">Last-Update</th>
        </tr>
        <tr>
          <th class="thinput"><input id="s0" on-keyup="{{changeSearchString}}"/></th>
          <th class="thinput"><input id="s1" on-keyup="{{changeSearchString}}"/></th>
          <th class="thinput"><input id="s2" on-keyup="{{changeSearchString}}"/></th>
          <th class="thinput"><input id="s3" on-keyup="{{changeSearchString}}"/></th>
          <th class="thinput"><input id="s4" on-keyup="{{changeSearchString}}"/></th>
        </tr>
      </thead>
      <tbody>
        <template id="usersinfotemplete" repeat="{{userinfo in usersdata | searchByKey(searchColumn,searchString) | sortByKey(sortColumn, sortDescending)}}">
          <tr class="border_top">
            <td>{{userinfo[0]}}</td>
            <td>{{userinfo[1]}}</td>
            <td><span class="color-success">{{userinfo[2]}}</span></td>
            <td><span class="label bgcolor-success">{{userinfo[3]}}</span></td>
            <td>{{userinfo[4]}}</td>
          </tr>
        </template>
      </tbody>
    </table>
    <paper-button on-click="{{addRow}}" raised>Click</paper-button>
  </template>
  <script>
    Polymer({
      usersdata:[["120050053","bhargav",[1,2],"connected","time"],["120050048","sundeep",[2,3],"done","time2"]],
      sortColumn:'0',
      sortDescending: true,
      searchString:'',
      searchColumn:'0',
      ready: function(){
      },
      addRow: function(){
        this.usersdata.push(["120050069","sumanth",[1,3],"disconnected","time3"]);
        //this.$.usersinfotemplete.iterator_.updateIteratedValue(); // Force Polymer to refresh template
      },
      changeSort: function(e,p,o){
        var clickedSortColumn = o.id;
        if(clickedSortColumn == this.sortColumn){
          //column already sorted, reverse sort
          this.sortDescending = !this.sortDescending;
        }else{
          this.sortColumn = clickedSortColumn;
        }
      },
      sortByKey : function(array, key, desc) {
        return array.sort(function(a, b) {
          var x = a[key];
          var y = b[key];
       
          if (typeof x == "string"){
            x = x.toLowerCase(); 
            y = y.toLowerCase();
          }
          if(desc){
            return ((x < y) ? 1 : ((x > y) ? -1 : 0));
          }else{
            return ((x < y) ? -1 : ((x > y) ? 1 : 0));
          }
        });
      },
      changeSearchString : function(e,p,o){
        //console.log(o.id[1]+" "+o.value);
        var searchedColumn = o.id[1];
        this.searchColumn = searchedColumn;
        this.searchString = o.value;
      },
      searchByKey : function(array, key, str) {
        return array.filter(function(a) {
          var x = a[key];
          //console.log(x+" "+str);
          if(x.indexOf(str) > -1) return 1;
          else return 0;
        });
      }
    })
  </script>
</polymer-element>
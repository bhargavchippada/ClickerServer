<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="custom-button.html">
<polymer-element name="server-element">
  <template>
  	<style>
    .user-heading {
      font-size: 22px;
      padding: 0 0 0 0;
      margin: 0 8px 0 0;
    }
    #filename {
      margin: 0 0 0 8px;
      width: 96px;
    }
    paper-button.bluecls {
      text-transform: inherit;
      background-color: #337ab7;
      color: #fff;
    }
    #radiogroup /deep/ paper-radio-button {
      padding-top: 0;
      padding-bottom: 0;
    }
    #radiogroup /deep/ paper-button {
      padding-top: 0;
      padding-bottom: 0;
    }
	  </style>
    <div layout vertical>
      <div layout horizontal center>
        <input type="file" id="browse" name="fileupload" style="display: none" on-change="{{Handlechange}}"/>
        <paper-radio-group id="radiogroup" selected="{{radioselected}}">
          <paper-radio-button name="userlist" label="User List" disabled?="{{radiodisable}}"></paper-radio-button>
          <paper-input class="filenamecls" id="filename" label="Path" disabled></paper-input>
          <paper-button id="fakeBrowse" raised class="bluecls" on-click="{{HandleBrowseClick}}" disabled?="{{radioselected!='userlist' || radiodisable}}">Upload List</paper-button>
          <paper-radio-button name="anyone" label="Anyone" disabled?="{{radiodisable}}"></paper-radio-button>
        </paper-radio-group>
        <div flex layout end-justified horizontal>
          <custom-button togglehtml0="Start Server" togglehtml1="Stop Server" togglestate='0'></custom-button>
        </div>
      </div>
    </div>
  </template>
  <script>
    var fcont = 'hello';
    var fready = false;
    Polymer({
      radiodisable:false,
      radioselected:'userlist',
      HandleBrowseClick: function(){
        console.log("browse click");
        this.$.browse.click();
      },
      frespChanged: function(oldValue,newValue){
        console.log("user list uploaded");
        console.log(fcont);
        this.$.filename.value = this.$.browse.value.replace("C:\\fakepath\\", "");
        this.$.browse.value=null;
      },
      fileUploader: function(event){
        if (event.target.readyState == FileReader.DONE) {
          fcont = event.target.result;
          fready = true;
        }
      },
      Handlechange: function(e,detail,sender){
        // Check for the various File API support.
        if (window.File && window.FileReader && window.FileList && window.Blob) {
          // Great success! All the File APIs are supported.
          var fReader = new FileReader();
          fReader.readAsText(this.$.browse.files[0]);
          //console.log(this.$.browse.files[0]);
          fReader.onloadend = this.fileUploader;
          fready = false;
          console.log("file upload initiated");
          this.async(function() {
            if(fready==true){
              //console.log(fcont);
              this.fresp = fcont;
            }
          }, null, 1000);
        } else {
          alert('The File APIs are not fully supported in this browser.');
        }
      }
    })
  </script>
</polymer-element>
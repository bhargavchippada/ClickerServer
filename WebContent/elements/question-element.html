<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="form-expanding-input.html">
<link rel="import" href="question-option.html">
<polymer-element name="question-element">
  <template>
    <style>
    	.form-heading {
				font-size: 36px;
				margin: 8px 0 0 0;
			}
			paper-radio-group {
				width: 100%;
			}
			#optionsgroup /deep/ question-option {
				padding :0 0 0 0;
			}
			question-option {
				width: 100%;
			}
			core-icon-button {
				background-color: #F7F7F9;
			}
      paper-toast {
        position: relative;
        text-align: center;
        background-color: #D9534F;
        bottom: 0;
        left: 0;
      }
    </style>
    <div layout vertical>
    	<p class="form-heading">Question:</p>
    	<form-expanding-input id="questionContent" label="Type Question" error="Type Some Question!" autofocus value="{{questionobj.qcontent}}"></form-expanding-input>
    	<paper-radio-group id="optionsgroup">
    		<template repeat="{{qoption in questionobj.qoptions}}">
    			<question-option optionvalue="{{qoption}}"></question-option>
    		</template>
    	</paper-radio-group>
    	<span><core-icon-button icon="add" on-click="{{addoption}}">add new option</core-icon-button></span>
      <div layout horizontal end-justified>
      <span><paper-toast id="toast" text="Please select some option!"></paper-toast></span></div>
    </div>
  </template>
  <script type="text/javascript">
  	Polymer({
  		publish:{
  			questionobj:{
  				value: {},
  				reflect:true
  			}
  		},
  		ready: function() {
  		},
  		addoption: function(){
  			console.log("add option clicked");
  			var qop = document.createElement('question-option');
  			this.$.optionsgroup.appendChild(qop);
  		},
  		validateform: function(){
        //console.log("form validate called");
        var failed = false;
        var qcontent = this.$.questionContent.value.trim();
        if(qcontent==''){
          this.$.questionContent.triggerError();
          this.$.questionContent.value='';
          failed=true;
        }else{
          console.log(qcontent);
        }
        var children = this.$.optionsgroup.querySelectorAll('question-option');
        var optionsList=new Array();
        var answersList=new Array();
        var optionstr;
        for (var i=0; i<children.length; i++) {
          optionstr=children[i].optionvalue;
          if(optionstr.trim()==''){
            children[i].triggerError();
            children[i].optionvalue='';
            failed=true;
          }else{
            optionsList.push(optionstr);
            if(children[i].checked){
              answersList.push(i);
            }
          }
        }
        if(answersList.length==0){
          this.$.toast.show();
          failed=true;
        }
        if(failed) return;
        console.log(optionsList);
        console.log(answersList);
  		}
  	})
  </script>
</polymer-element>
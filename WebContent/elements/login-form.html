<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="form-input.html">
<polymer-element name="login-form">
  <template>
  	<style>
  	:host {
      display: block;
      width: 100%;
    }
    div {
    	width: 100%;
      padding: 8px 0;
      text-align: center;
    }
    form-input {
    	width: 100%;
    }
    .form-title {
    	font-size: 36px;
    	margin: 0 0;
    	color: #333;
    }
    .form-heading {
      font-size: 32px;
      margin: 0 0;
      text-align: left;
      color: #333;
    }
    paper-button {
    	width: 128px;
    	margin-top: 8px;
    	background: #337AB7;
      color: white;
      font-size: 18px;
      text-transform: inherit;
      border-radius: 6px;
    }
    #error_display{
    	color:#D9534F;
    	margin-top: 8px;
    	font-size: 22px;
    }
  	</style>
    <core-ajax
        url="../AdminLogin"
        params='{"user_username":"{{login_username}}", "user_password":"{{login_password}}"}'
        handleAs="json"
        response="{{response}}"
        contentType="application/json"
        id="loginDataAuth"
        on-core-response="{{handleResponse}}"
        error="{{errorresp}}"
        on-core-error="{{handleError}}"></core-ajax>
    <div layout vertical center>
	    <div layout vertical>
	    	<p class="form-title">Administrator</p>
        <p class="form-heading">Sign In</p>
        <form-input id="inp_username" label="Username" error="username is required!" value="{{login_username}}" autofocus></form-input>
        <form-input id="inp_password" label="Password" error="password is required!" value="{{login_password}}" type="password"></form-input>
	    	<div>
	    		<paper-button on-click={{submitLoginCred}}>Log In</paper-button>
	    		<p id="error_display"></p>
	    	</div>
	    </div>
	  </div>
  </template>
  <<script>
  	Polymer({
  		login_username: '',
  		login_password: '',
  		submitLoginCred: function(){
  			if(this.login_username != '' && this.login_password != ''){
  				this.$.loginDataAuth.go();
  			}else if(this.login_username == ''){
  				this.$.inp_username.triggerError();
  			}else{
  				this.$.inp_password.triggerError();
  			}
  		},
  		handleResponse: function(event, response) {
          if(this.response.redirectURL) {
	          window.location = this.response.url;
	        }else{
	          this.$.error_display.innerHTML = this.response.error_msg;
	        }
      },
      handleError: function(event, response) {
        if(this.errorresp!=null){
          console.log(this.errorresp.response);
          this.$.error_display.innerHTML = this.errorresp.response;
        }
      }
  	});
  </script>
</polymer-element>